"use strict";(self["webpackChunkd1"]=self["webpackChunkd1"]||[]).push([[728],{74397:function(e,t,n){n.d(t,{A:function(){return w}});n(16573),n(78100),n(77936),n(37467),n(44732),n(79577);var r=n(33672),a=n(10935),o=n(68718),i=n(87322),l=n(74998),f=n(5148),s=n(50296),c=n(36544),u=n(41277),d=n(94573),h=n(2739),p=n(15501),v="#define SAMPLE_NUMBER 1024\n#define PI 3.14159265358979\nuniform sampler2D normalDistribution;\nuniform vec2 viewportSize : [512, 256];\nconst vec3 N = vec3(0.0, 0.0, 1.0);\nconst float fSampleNumber = float(SAMPLE_NUMBER);\nvec3 importanceSampleNormal(float i, float roughness, vec3 N) {\n vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;\n vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n vec3 tangentX = normalize(cross(N, upVector));\n vec3 tangentZ = cross(N, tangentX);\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n}\nfloat G_Smith(float roughness, float NoV, float NoL) {\n float k = roughness * roughness / 2.0;\n float G1V = NoV / (NoV * (1.0 - k) + k);\n float G1L = NoL / (NoL * (1.0 - k) + k);\n return G1L * G1V;\n}\nvoid main() {\n vec2 uv = gl_FragCoord.xy / viewportSize;\n float NoV = uv.x;\n float roughness = uv.y;\n vec3 V;\n V.x = sqrt(1.0 - NoV * NoV);\n V.y = 0.0;\n V.z = NoV;\n float A = 0.0;\n float B = 0.0;\n for (int i = 0; i < SAMPLE_NUMBER; i++) {\n vec3 H = importanceSampleNormal(float(i) / fSampleNumber, roughness, N);\n vec3 L = reflect(-V, H);\n float NoL = clamp(L.z, 0.0, 1.0);\n float NoH = clamp(H.z, 0.0, 1.0);\n float VoH = clamp(dot(V, H), 0.0, 1.0);\n if (NoL > 0.0) {\n float G = G_Smith(roughness, NoV, NoL);\n float G_Vis = G * VoH / (NoH * NoV);\n float Fc = pow(1.0 - VoH, 5.0);\n A += (1.0 - Fc) * G_Vis;\n B += Fc * G_Vis;\n }\n }\n gl_FragColor = vec4(vec2(A, B) / fSampleNumber, 0.0, 1.0);\n}\n",m="#define SHADER_NAME prefilter\n#define SAMPLE_NUMBER 1024\n#define PI 3.14159265358979\nuniform mat4 viewInverse : VIEWINVERSE;\nuniform samplerCube environmentMap;\nuniform sampler2D normalDistribution;\nuniform float roughness : 0.5;\nvarying vec2 v_Texcoord;\nvarying vec3 v_WorldPosition;\n@import clay.util.rgbm\nvec3 importanceSampleNormal(float i, float roughness, vec3 N) {\n vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;\n vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n vec3 tangentX = normalize(cross(N, upVector));\n vec3 tangentZ = cross(N, tangentX);\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n}\nvoid main() {\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(v_WorldPosition - eyePos);\n vec3 N = V;\n vec3 prefilteredColor = vec3(0.0);\n float totalWeight = 0.0;\n float fMaxSampleNumber = float(SAMPLE_NUMBER);\n for (int i = 0; i < SAMPLE_NUMBER; i++) {\n vec3 H = importanceSampleNormal(float(i) / fMaxSampleNumber, roughness, N);\n vec3 L = reflect(-V, H);\n float NoL = clamp(dot(N, L), 0.0, 1.0);\n if (NoL > 0.0) {\n prefilteredColor += decodeHDR(textureCube(environmentMap, L)).rgb * NoL;\n totalWeight += NoL;\n }\n }\n gl_FragColor = encodeHDR(vec4(prefilteredColor / totalWeight, 1.0));\n}\n",A={},g=["px","nx","py","ny","pz","nz"];A.prefilterEnvironmentMap=function(e,t,n,l,v){v&&l||(l=A.generateNormalDistribution(),v=A.integrateBRDF(e,l)),n=n||{};var w=n.width||64,M=n.height||64,N=n.type||t.type,E=new a.A({width:w,height:M,type:N,flipY:!1,mipmaps:[]});E.isPowerOfTwo()||console.warn("Width and height must be power of two to enable mipmap.");var y=Math.min(w,M),x=Math.log(y)/Math.log(2)+1,_=new f.A({shader:new s.A({vertex:s.A.source("clay.skybox.vertex"),fragment:m})});_.set("normalDistribution",l),n.encodeRGBM&&_.define("fragment","RGBM_ENCODE"),n.decodeRGBM&&_.define("fragment","RGBM_DECODE");var b,D=new u.A;if("texture2D"===t.textureType){var T=new a.A({width:w,height:M,type:N===o.A.FLOAT?o.A.HALF_FLOAT:N});p.A.panoramaToCubeMap(e,t,T,{encodeRGBM:n.decodeRGBM}),t=T}b=new c.A({scene:D,material:_}),b.material.set("environmentMap",t);var R=new d.A({texture:E});n.encodeRGBM&&(N=E.type=o.A.UNSIGNED_BYTE);for(var S=new r.A({width:w,height:M,type:N}),G=new i.A({depthBuffer:!1}),C=h.A[N===o.A.UNSIGNED_BYTE?"Uint8Array":"Float32Array"],B=0;B<x;B++){E.mipmaps[B]={pixels:{}},b.material.set("roughness",B/(x-1));for(var L=S.width,V=2*Math.atan(L/(L-.5))/Math.PI*180,P=0;P<g.length;P++){var H=new C(S.width*S.height*4);G.attach(S),G.bind(e);var F=R.getCamera(g[P]);F.fov=V,e.render(D,F),e.gl.readPixels(0,0,S.width,S.height,o.A.RGBA,N,H),G.unbind(e),E.mipmaps[B].pixels[g[P]]=H}S.width/=2,S.height/=2,S.dirty()}return G.dispose(e),S.dispose(e),b.dispose(e),l.dispose(e),{environmentMap:E,brdfLookup:v,normalDistribution:l,maxMipmapLevel:x}},A.integrateBRDF=function(e,t){t=t||A.generateNormalDistribution();var n=new i.A({depthBuffer:!1}),a=new l.A({fragment:v}),f=new r.A({width:512,height:256,type:o.A.HALF_FLOAT,wrapS:o.A.CLAMP_TO_EDGE,wrapT:o.A.CLAMP_TO_EDGE,minFilter:o.A.NEAREST,magFilter:o.A.NEAREST,useMipmap:!1});return a.setUniform("normalDistribution",t),a.setUniform("viewportSize",[512,256]),a.attachOutput(f),a.render(e,n),n.dispose(e),f},A.generateNormalDistribution=function(e,t){e=e||256,t=t||1024;for(var n=new r.A({width:e,height:t,type:o.A.FLOAT,minFilter:o.A.NEAREST,magFilter:o.A.NEAREST,wrapS:o.A.CLAMP_TO_EDGE,wrapT:o.A.CLAMP_TO_EDGE,useMipmap:!1}),a=new Float32Array(t*e*4),i=[],l=0;l<e;l++){for(var f=l/e,s=f*f,c=0;c<t;c++){var u=(c<<16|c>>>16)>>>0;u=((1431655765&u)<<1|(2863311530&u)>>>1)>>>0,u=((858993459&u)<<2|(3435973836&u)>>>2)>>>0,u=((252645135&u)<<4|(4042322160&u)>>>4)>>>0,u=(((16711935&u)<<8|(4278255360&u)>>>8)>>>0)/4294967296;var d=Math.sqrt((1-u)/(1+(s*s-1)*u));i[c]=d}for(c=0;c<t;c++){var h=4*(c*e+l),p=(d=i[c],Math.sqrt(1-d*d)),v=c/t,m=2*Math.PI*v;a[h]=p*Math.cos(m),a[h+1]=d,a[h+2]=p*Math.sin(m),a[h+3]=1}}return n.pixels=a,n};var w=A},12495:function(e,t,n){n(16573),n(78100),n(77936),n(37467),n(44732),n(79577);var r=n(68718),a=n(87322),o=n(33672),i=n(2739),l=n(36544),f=n(58463),s=n(94573),c=n(41277),u=n(33301),d={},h=["px","nx","py","ny","pz","nz"];function p(e,t){var n=e[0],r=e[1],a=e[2];return 0===t?1:1===t?n:2===t?r:3===t?a:4===t?n*a:5===t?r*a:6===t?n*r:7===t?3*a*a-1:n*n-r*r}var v={px:[2,1,0,-1,-1,1],nx:[2,1,0,1,-1,-1],py:[0,2,1,1,-1,-1],ny:[0,2,1,1,1,1],pz:[0,1,2,-1,-1,-1],nz:[0,1,2,1,-1,1]};function m(e,t,n,r){for(var a=new i.A.Float32Array(27),o=u.A.create(),l=u.A.create(),f=u.A.create(),s=0;s<9;s++){for(var c=u.A.create(),d=0;d<h.length;d++){for(var m=t[h[d]],A=u.A.create(),g=0,w=0,M=v[h[d]],N=0;N<r;N++)for(var E=0;E<n;E++){o[0]=E/(n-1)*2-1,o[1]=N/(r-1)*2-1,o[2]=-1,u.A.normalize(o,o),f[0]=o[M[0]]*M[3],f[1]=o[M[1]]*M[4],f[2]=o[M[2]]*M[5],l[0]=m[w++]/255,l[1]=m[w++]/255,l[2]=m[w++]/255;var y=m[w++]/255*8.12;l[0]*=y,l[1]*=y,l[2]*=y,u.A.scaleAndAdd(A,A,l,p(f,s)*-o[2]),g+=-o[2]}u.A.scaleAndAdd(c,c,A,1/g)}a[3*s]=c[0]/6,a[3*s+1]=c[1]/6,a[3*s+2]=c[2]/6}return a}d.projectEnvironmentMap=function(e,t,n){var i;n=n||{},n.lod=n.lod||0;var u=new c.A,d=64;"texture2D"===t.textureType?i=new f.A({scene:u,environmentMap:t}):(d=t.image&&t.image.px?t.image.px.width:t.width,i=new l.A({scene:u,environmentMap:t}));var p=Math.ceil(d/Math.pow(2,n.lod)),v=Math.ceil(d/Math.pow(2,n.lod)),A=new o.A({width:p,height:v}),g=new a.A;i.material.define("fragment","RGBM_ENCODE"),n.decodeRGBM&&i.material.define("fragment","RGBM_DECODE"),i.material.set("lod",n.lod);for(var w=new s.A({texture:A}),M={},N=0;N<h.length;N++){M[h[N]]=new Uint8Array(p*v*4);var E=w.getCamera(h[N]);E.fov=90,g.attach(A),g.bind(e),e.render(u,E),e.gl.readPixels(0,0,p,v,r.A.RGBA,r.A.UNSIGNED_BYTE,M[h[N]]),g.unbind(e)}return i.dispose(e),g.dispose(e),A.dispose(e),m(e,M,p,v)},t.A=d},15501:function(e,t,n){n.d(t,{A:function(){return O}});var r=n(33672),a=n(10935),o=n(2739),i=n(94573),l=n(58463),f=n(41277),s=(n(16573),n(78100),n(77936),n(37467),n(44732),n(79577),n(68718)),c=542327876,u=131072,d=512,h=4;function p(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var v=31,m=p("DXT1"),A=p("DXT3"),g=p("DXT5"),w=0,M=1,N=2,E=3,y=4,x=7,_=20,b=21,D=28,T={parse:function(e,t){var n=new Int32Array(e,0,v);if(n[w]!==c)return null;if(!n(_)&h)return null;var a,o,i=n(b),l=n[y],f=n[E],p=n[D]&d,T=n[N]&u;switch(i){case m:a=8,o=s.A.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case A:a=16,o=s.A.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case g:a=16,o=s.A.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}var R=n[M]+4,S=p?6:1,G=1;T&&(G=Math.max(1,n[x]));for(var C=[],B=0;B<S;B++){var L=l,V=f;C[B]=new r.A({width:L,height:V,format:o});for(var P=[],H=0;H<G;H++){var F=Math.max(4,L)/4*Math.max(4,V)/4*a,z=new Uint8Array(e,R,F);R+=F,L*=.5,V*=.5,P[H]=z}C[B].pixels=P[0],T&&(C[B].mipmaps=P)}if(!t)return C[0];t.width=C[0].width,t.height=C[0].height,t.format=C[0].format,t.pixels=C[0].pixels,t.mipmaps=C[0].mipmaps}},R=T,S=String.fromCharCode,G=8,C=32767;function B(e,t,n,r){if(e[3]>0){var a=Math.pow(2,e[3]-128-8+r);t[n+0]=e[0]*a,t[n+1]=e[1]*a,t[n+2]=e[2]*a}else t[n+0]=0,t[n+1]=0,t[n+2]=0;return t[n+3]=1,t}function L(e,t,n){for(var r="",a=t;a<n;a++)r+=S(e[a]);return r}function V(e,t){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]}function P(e,t,n,r){var a=0,o=0,i=r;while(i>0)if(e[o][0]=t[n++],e[o][1]=t[n++],e[o][2]=t[n++],e[o][3]=t[n++],1===e[o][0]&&1===e[o][1]&&1===e[o][2]){for(var l=e[o][3]<<a>>>0;l>0;l--)V(e[o-1],e[o]),o++,i--;a+=8}else o++,i--,a=0;return n}function H(e,t,n,r){if(r<G|r>C)return P(e,t,n,r);var a=t[n++];if(2!=a)return P(e,t,n-1,r);if(e[0][1]=t[n++],e[0][2]=t[n++],a=t[n++],(e[0][2]<<8>>>0|a)>>>0!==r)return null;for(a=0;a<4;a++)for(var o=0;o<r;){var i=t[n++];if(i>128){i=(127&i)>>>0;var l=t[n++];while(i--)e[o++][a]=l}else while(i--)e[o++][a]=t[n++]}return n}var F={parseRGBE:function(e,t,n){null==n&&(n=0);var a=new Uint8Array(e),o=a.length;if("#?"===L(a,0,2)){for(var i=2;i<o;i++)if("\n"===S(a[i])&&"\n"===S(a[i+1]))break;if(!(i>=o)){i+=2;for(var l="";i<o;i++){var f=S(a[i]);if("\n"===f)break;l+=f}var c=l.split(" "),u=parseInt(c[1]),d=parseInt(c[3]);if(d&&u){for(var h=i+1,p=[],v=0;v<d;v++){p[v]=[];for(var m=0;m<4;m++)p[v][m]=0}for(var A=new Float32Array(d*u*4),g=0,w=0;w<u;w++){h=H(p,a,h,d);if(!h)return null;for(v=0;v<d;v++)B(p[v],A,g,n),g+=4}return t||(t=new r.A),t.width=d,t.height=u,t.pixels=A,t.type=s.A.FLOAT,t}}}},parseRGBEFromPNG:function(e){}},z=F,I={loadTexture:function(e,t,n,o){var i;if("function"===typeof t?(n=t,o=n,t={}):t=t||{},"string"===typeof e){if(e.match(/.hdr$/)||"hdr"===t.fileType)return i=new r.A({width:0,height:0,sRGB:!1}),I._fetchTexture(e,(function(e){z.parseRGBE(e,i,t.exposure),i.dirty(),n&&n(i)}),o),i;e.match(/.dds$/)||"dds"===t.fileType?(i=new r.A({width:0,height:0}),I._fetchTexture(e,(function(e){R.parse(e,i),i.dirty(),n&&n(i)}),o)):(i=new r.A,i.load(e),i.success(n),i.error(o))}else"object"===typeof e&&"undefined"!==typeof e.px&&(i=new a.A,i.load(e),i.success(n),i.error(o));return i},loadPanorama:function(e,t,n,r,a,o){var i=this;"function"===typeof r?(a=r,o=a,r={}):r=r||{},I.loadTexture(t,r,(function(t){t.flipY=r.flipY||!1,i.panoramaToCubeMap(e,t,n,r),t.dispose(e),a&&a(n)}),o)},panoramaToCubeMap:function(e,t,n,r){var a=new i.A,o=new l.A({scene:new f.A});return o.setEnvironmentMap(t),r=r||{},r.encodeRGBM&&o.material.define("fragment","RGBM_ENCODE"),n.sRGB=t.sRGB,a.texture=n,a.render(e,o.scene),a.texture=null,a.dispose(e),n},heightToNormal:function(e,t){var n=document.createElement("canvas"),r=n.width=e.width,a=n.height=e.height,o=n.getContext("2d");o.drawImage(e,0,0,r,a),t=t||!1;for(var i=o.getImageData(0,0,r,a),l=o.createImageData(r,a),f=0;f<i.data.length;f+=4){if(t){var s=i.data[f],c=i.data[f+1],u=i.data[f+2],d=Math.abs(s-c)+Math.abs(c-u);if(d>20)return console.warn("Given image is not a height map"),e}var h,p,v,m;f%(4*r)===0?(h=i.data[f],v=i.data[f+4]):f%(4*r)===4*(r-1)?(h=i.data[f-4],v=i.data[f]):(h=i.data[f-4],v=i.data[f+4]),f<4*r?(p=i.data[f],m=i.data[f+4*r]):f>r*(a-1)*4?(p=i.data[f-4*r],m=i.data[f]):(p=i.data[f-4*r],m=i.data[f+4*r]),l.data[f]=h-v+127,l.data[f+1]=p-m+127,l.data[f+2]=255,l.data[f+3]=255}return o.putImageData(l,0,0),n},isHeightImage:function(e,t,n){if(!e||!e.width||!e.height)return!1;var r=document.createElement("canvas"),a=r.getContext("2d"),o=t||32;n=n||20,r.width=r.height=o,a.drawImage(e,0,0,o,o);for(var i=a.getImageData(0,0,o,o),l=0;l<i.data.length;l+=4){var f=i.data[l],s=i.data[l+1],c=i.data[l+2],u=Math.abs(f-s)+Math.abs(s-c);if(u>n)return!1}return!0},_fetchTexture:function(e,t,n){o.A.request.get({url:e,responseType:"arraybuffer",onload:t,onerror:n})},createChessboard:function(e,t,n,a){e=e||512,t=t||64,n=n||"black",a=a||"white";var o=Math.ceil(e/t),i=document.createElement("canvas");i.width=e,i.height=e;var l=i.getContext("2d");l.fillStyle=a,l.fillRect(0,0,e,e),l.fillStyle=n;for(var f=0;f<o;f++)for(var s=0;s<o;s++){var c=s%2?f%2:f%2-1;c&&l.fillRect(f*t,s*t,t,t)}var u=new r.A({image:i,anisotropic:8});return u},createBlank:function(e){var t=document.createElement("canvas");t.width=1,t.height=1;var n=t.getContext("2d");n.fillStyle=e,n.fillRect(0,0,1,1);var a=new r.A({image:t});return a}},O=I}}]);
//# sourceMappingURL=chunk-vendors-c06fdc76.e95a3cad.js.map